<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2019-11-25 Mon 12:36 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Familiar With Linux Networking Command Line Tools</title>
<meta name="generator" content="Org mode">
<meta name="author" content="WANG Xiaolin">
<link rel="stylesheet" href="https://cs6.swfu.edu.cn/org.css" type="text/css">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Familiar With Linux Networking Command Line Tools</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org39c1231">1. iproute2, <code>ifconfig</code>, <code>arp</code>, <code>route</code> &#x2014; Configure A Network Interface</a></li>
<li><a href="#org7ceb77d">2. ping &#x2014; send ICMP ECHO_REQUEST to network hosts</a></li>
<li><a href="#org0da55af">3. route &#x2014; show / manipulate the IP routing table</a></li>
<li><a href="#org1704319">4. netstat &#x2014; Print network information</a></li>
<li><a href="#org821a93a">5. tcpdump &#x2014; dump traffic on a network</a>
<ul>
<li><a href="#org3da49f9">5.1. Exercise &#x2014; Get a clear idea about the output</a></li>
<li><a href="#orgfb82df6">5.2. Basic examples</a></li>
<li><a href="#org4245d36">5.3. host/src/dst</a></li>
<li><a href="#org75e0d50">5.4. proto</a></li>
<li><a href="#org506685d">5.5. port</a></li>
<li><a href="#org59b7188">5.6. src port, dst port</a></li>
<li><a href="#org41440ea">5.7. portrange</a></li>
<li><a href="#org307c378">5.8. src/dst, port, protocol</a></li>
<li><a href="#org2d139ef">5.9. read/write</a></li>
<li><a href="#orga455ccc">5.10. grouping &#x2014; for complex queries</a></li>
<li><a href="#org5e8027f">5.11. References</a></li>
</ul>
</li>
<li><a href="#org24afe61">6. iptables &#x2014; administration tool for IPv4 packet filtering and NAT</a>
<ul>
<li><a href="#org4407369">6.1. References</a></li>
<li><a href="#org953bca7">6.2. Big picture</a></li>
<li><a href="#orga58e179">6.3. Basic Examples</a></li>
<li><a href="#org483936b">6.4. More Examples</a></li>
</ul>
</li>
<li><a href="#orgf8e73fa">7. netcat &#x2014; TCP/IP swiss army knife</a>
<ul>
<li><a href="#org9735cca">7.1. Setup a simple C/S chat session</a></li>
<li><a href="#org08306cd">7.2. Transferring Files</a></li>
<li><a href="#orgf43aeef">7.3. Other Examples</a></li>
<li><a href="#org6bf4547">7.4. Telnet-like Usage</a></li>
<li><a href="#org163a546">7.5. Works as a Port Scanner too</a></li>
<li><a href="#org98fa32b">7.6. Grab Port Banners</a></li>
</ul>
</li>
<li><a href="#org7364b0f">8. nmap &#x2014; Network exploration tool and security / port scanner</a>
<ul>
<li><a href="#org83e0c1b">8.1. Simple Examples</a></li>
<li><a href="#org1513d88">8.2. Scanning more than one machine</a></li>
<li><a href="#orga0fc6e1">8.3. Scanning specific ports:</a></li>
<li><a href="#org9af6caa">8.4. Various Scanning options:</a>
<ul>
<li><a href="#org6122615">8.4.1. <code>-sS</code></a></li>
<li><a href="#orgb6ca27f">8.4.2. <code>-sT</code></a></li>
<li><a href="#orgf4aa76f">8.4.3. <code>-sF</code>, <code>-sX</code>, <code>-sN</code></a></li>
<li><a href="#org0616a40">8.4.4. <code>-sU</code></a></li>
<li><a href="#org913be65">8.4.5. <code>-sO</code></a></li>
<li><a href="#org12f5e6e">8.4.6. <code>-sR</code></a></li>
<li><a href="#org8713433">8.4.7. <code>-sV</code></a></li>
<li><a href="#org3806be8">8.4.8. <code>-sA</code></a></li>
<li><a href="#orgd2e9d28">8.4.9. <code>-sI</code></a></li>
<li><a href="#orgd011319">8.4.10. <code>-sP</code>: Ping scan</a></li>
<li><a href="#org9e97383">8.4.11. <code>-sW</code>: Window scan</a></li>
<li><a href="#org5ad92d4">8.4.12. <code>-sL</code>: List scan</a></li>
</ul>
</li>
<li><a href="#orgdb0e4d5">8.5. O/S fingerprinting and version detection</a>
<ul>
<li><a href="#org4babee1">8.5.1. <code>-O</code></a></li>
<li><a href="#org2e8a88f">8.5.2. <code>-sV</code></a></li>
<li><a href="#org0655b81">8.5.3. <code>-A</code>: Additional, Advanced, Aggressive option</a></li>
</ul>
</li>
<li><a href="#org4acb33a">8.6. Typical scenario</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org39c1231" class="outline-2">
<h2 id="org39c1231"><span class="section-number-2">1</span> iproute2, <code>ifconfig</code>, <code>arp</code>, <code>route</code> &#x2014; Configure A Network Interface</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li><p>
<b>References</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">man ip
man ip-address
man ip-link
man ip-neighbour
man ip-route
man ifconfig
man arp
man route
</pre>
</div></li>
<li><p>
To <b>show</b> active network interfaces
</p>
<div class="org-src-container">
<pre class="src src-sh">ip addr
ip addr show eth0
ip addr show up
ip -s link
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
ifconfig -a
ifconfig eth0
ifconfig
</pre>
</div></li>
<li><p>
To <b>assign</b> IP address 192.168.8.8 to <i>eth0</i>
</p>
<div class="org-src-container">
<pre class="src src-sh">ip addr add 192.168.8.8/24 dev eth0
ip addr add 192.168.8.9/24 dev eth0 label eth0:1
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
ifconfig eth0 192.168.8.8 netmask 255.255.255.0
ifconfig eth0:1 192.168.8.9 netmask 255.255.255.0
</pre>
</div></li>
<li><p>
To <b>delete</b> IP address
</p>
<div class="org-src-container">
<pre class="src src-sh">ip addr del 192.168.8.9/24 dev eth0
</pre>
</div></li>
<li><p>
To bring <i>eth0</i> up
</p>
<div class="org-src-container">
<pre class="src src-sh">ip link set eth0 up
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
ifconfig eth0 up
</pre>
</div></li>
<li><p>
To bring <i>eth0</i> down
</p>
<div class="org-src-container">
<pre class="src src-sh">ip link set eth0 down
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
ifconfig eth0 down    
</pre>
</div></li>
<li><p>
ARP
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Display the ARP cache</span>
ip neigh show
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
arp -an
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
ip neigh show dev eth0
ip neigh show 192.168.1.1

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Add a permanent ARP entry</span>
ip neigh add 192.168.1.4 lladdr aa:bb:cc:dd:ee:ff dev eth0 nud permanent
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
arp -i eth0 -s 192.168.1.4 aa:bb:cc:dd:ee:ff

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Change an ARP entry</span>
ip neigh change 192.168.1.4 lladdr aa:bb:cc:dd:ee:ff dev eth0

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Delete an entry</span>
ip neigh del 192.168.1.4 lladdr aa:bb:cc:dd:ee:ff dev eth0 nud permanent
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
arp -d 192.168.1.4

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Flush the ARP cache</span>
ip neigh flush dev eth0
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org7ceb77d" class="outline-2">
<h2 id="org7ceb77d"><span class="section-number-2">2</span> ping &#x2014; send ICMP ECHO_REQUEST to network hosts</h2>
<div class="outline-text-2" id="text-2">
<p>
To check network availability to some host, e.g. <i>cs3.swfu.edu.cn</i>, do
</p>
<div class="org-src-container">
<pre class="src src-sh">ping cs3.swfu.edu.cn
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">ping 10 times</span>
ping -c 10 cs3.swfu.edu.cn
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">ping every 10 seconds</span>
ping -i 10 cs3.swfu.edu.cn
</pre>
</div>
</div>
</div>

<div id="outline-container-org0da55af" class="outline-2">
<h2 id="org0da55af"><span class="section-number-2">3</span> route &#x2014; show / manipulate the IP routing table</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Check routing table</span>
ip route show
ip route get 202.203.132.244
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
netstat -rn
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
route -n

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Manually add a new route to a host (e.g. 192.168.1.5) through gateway 192.168.1.1, do</span>
ip route add 192.168.1.5/24 via 192.168.1.1
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
route add 192.168.1.5 netmask 255.255.255.255 gw 192.168.1.1

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Manually add a default route through gateway 192.168.1.1, do</span>
ip route add default via 192.168.1.1
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
route add default gw 192.168.1.1

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To manually delete a route</span>
ip route del 192.168.1.5/24 via 192.168.1.1
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
route del 192.168.1.5

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To manually delete a default route</span>
ip route del default
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">or</span>
route del default
</pre>
</div>

<ul class="org-ul">
<li><code>man route</code> for more examples.</li>
</ul>
</div>
</div>
<div id="outline-container-org1704319" class="outline-2">
<h2 id="org1704319"><span class="section-number-2">4</span> netstat &#x2014; Print network information</h2>
<div class="outline-text-2" id="text-4">
<p>
<code>netstat</code> displays all open sockets by default
</p>
<div class="org-src-container">
<pre class="src src-sh">netstat
<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Display only TCP connections</span>
netstat --tcp --numeric

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Show which program is listening on which port</span>
netstat --tcp --listening --programs

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Show routing table</span>
netstat --route

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Display network statistics</span>
netstat --statistics
</pre>
</div>
</div>
</div>

<div id="outline-container-org821a93a" class="outline-2">
<h2 id="org821a93a"><span class="section-number-2">5</span> tcpdump &#x2014; dump traffic on a network</h2>
<div class="outline-text-2" id="text-5">
<p>
You have to be <i>root</i> (<code>sudo</code>) to execute most <code>tcpdump</code> functions.
</p>
</div>
<div id="outline-container-org3da49f9" class="outline-3">
<h3 id="org3da49f9"><span class="section-number-3">5.1</span> Exercise &#x2014; Get a clear idea about the output</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">1. Open a CLI terminal *A*, type:</span>
tcpdump -XS -i lo host localhost

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">2. Open another CLI terminal *B*, and type:</span>
nc -l 3333

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">3. Open one more CLI terminal *C*, type:</span>
nc localhost 3333

<span style="color: #607d8b;"># </span><span style="color: #607d8b;">Can you see the 3-way handshake in terminal *A*?</span>

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">4. Now, in terminal *B* or *C*, type any single letter to see what you get in terminal *A*.</span>
<span style="color: #607d8b;">#      </span><span style="color: #607d8b;">Try to explain what you have seen.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb82df6" class="outline-3">
<h3 id="orgfb82df6"><span class="section-number-3">5.2</span> Basic examples</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-sh">tcpdump -nS
tcpdump -nnvvS
tcpdump -nnvvXS
tcpdump -nnvvXS -c2 icmp
tcpdump ip6

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To capture packets that are above or below a certain size:</span>
tcpdump less 128
tcpdump greater 256
tcpdump &gt; 256
tcpdump &lt;= 128
</pre>
</div>
</div>
</div>

<div id="outline-container-org4245d36" class="outline-3">
<h3 id="org4245d36"><span class="section-number-3">5.3</span> host/src/dst</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">To print all packets arriving at or departing from cs3:</span>
tcpdump host cs3.swfu.edu.cn

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To print all packets departing from cs3:</span>
tcpdump src  cs3.swfu.edu.cn

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To print all packets arriving at cs3:</span>
tcpdump dst  cs3.swfu.edu.cn
</pre>
</div>
</div>
</div>

<div id="outline-container-org75e0d50" class="outline-3">
<h3 id="org75e0d50"><span class="section-number-3">5.4</span> proto</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">works for 'tcp', 'udp', and 'icmp'. Note that you don't have to type 'proto'</span>
tcpdump icmp
tcpdump udp
tcpdump tcp
</pre>
</div>
</div>
</div>

<div id="outline-container-org506685d" class="outline-3">
<h3 id="org506685d"><span class="section-number-3">5.5</span> port</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">see only traffic to or from a certain port</span>
tcpdump port 80
</pre>
</div>
</div>
</div>

<div id="outline-container-org59b7188" class="outline-3">
<h3 id="org59b7188"><span class="section-number-3">5.6</span> src port, dst port</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">
<pre class="src src-sh">tcpdump src port 1025
tcpdump dst port 80
</pre>
</div>
</div>
</div>

<div id="outline-container-org41440ea" class="outline-3">
<h3 id="org41440ea"><span class="section-number-3">5.7</span> portrange</h3>
<div class="outline-text-3" id="text-5-7">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">see traffic to any port in a range</span>
tcpdump portrange 21-23
</pre>
</div>
</div>
</div>

<div id="outline-container-org307c378" class="outline-3">
<h3 id="org307c378"><span class="section-number-3">5.8</span> src/dst, port, protocol</h3>
<div class="outline-text-3" id="text-5-8">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">combine all three</span>
tcpdump tcp and dst port 80
tcpdump tcp dst port 80
tcpdump tcp port 80

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Capture both DNS packets and TCP packets to/from cs3.swfu.edu.cn</span>
tcpdump <span style="color: #689f38;">"(tcp and host cs3.swfu.edu.cn) or udp port 53"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d139ef" class="outline-3">
<h3 id="org2d139ef"><span class="section-number-3">5.9</span> read/write</h3>
<div class="outline-text-3" id="text-5-9">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">write output to a file, or read a data file</span>
tcpdump -s 1514 port 80 -w capture_file
tcpdump -r capture_file
</pre>
</div>
</div>
</div>

<div id="outline-container-orga455ccc" class="outline-3">
<h3 id="orga455ccc"><span class="section-number-3">5.10</span> grouping &#x2014; for complex queries</h3>
<div class="outline-text-3" id="text-5-10">
<div class="org-src-container">
<pre class="src src-sh">tcpdump src 10.0.2.4 and (dst port 3389 or 22)
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">Error? try this:</span>
tcpdump <span style="color: #689f38;">'src 10.0.2.4 and (dst port 3389 or 22)'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e8027f" class="outline-3">
<h3 id="org5e8027f"><span class="section-number-3">5.11</span> References</h3>
<div class="outline-text-3" id="text-5-11">
<ul class="org-ul">
<li><a href="http://danielmiessler.com/study/tcpdump/">A tcpdump Tutorial and Primer</a></li>
<li><code>man tcpdump</code></li>
<li><a href="http://www.ietf.org/rfc/rfc793.txt">RFC793</a></li>
<li><a href="http://www.ietf.org/rfc/rfc791.txt">RFC791</a></li>
<li><a href="http://tutorial.msamir.net/tcpdump.htm">tcpdump video tutorial</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org24afe61" class="outline-2">
<h2 id="org24afe61"><span class="section-number-2">6</span> iptables &#x2014; administration tool for IPv4 packet filtering and NAT</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org4407369" class="outline-3">
<h3 id="org4407369"><span class="section-number-3">6.1</span> References</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li><a href="http://www.netfilter.org/documentation/">http://www.netfilter.org/documentation/</a></li>
<li><a href="http://www.frozentux.net/iptables-tutorial/chunkyhtml/">Iptables Tutorial</a></li>
<li><code>man iptables</code></li>
<li><a href="http://tldp.org/LDP/nag/nag.html">Linux Network Administrators Guide</a>, chapter 9.</li>
<li><a href="http://cs3.swfu.edu.cn/pub/Books/network/OReilly-TCPIPNetworkAdministration3rdEdition.chm">TCP/IP Network Administration</a>, 3rd Edition, Apr 2002, O´REILLY.</li>
<li><a href="http://en.wikipedia.org/wiki/iptables">Wikipedia &#x2013; iptables</a></li>
<li><a href="http://www.faqs.org/rfcs/rfc2663.html">RFC2663 &#x2013; NAT Terminology and Considerations</a></li>
<li><a href="http://www.faqs.org/rfcs/rfc3022.html">RFC3022 &#x2013; Traditional NAT</a></li>
<li><a href="http://www.faqs.org/rfcs/rfc2827.html">RFC2827 &#x2013; Network Ingress Filtering</a></li>
<li><a href="http://www.faqs.org/rfcs/rfc1858.html">RFC1858 &#x2013; Security Considerations - IP Fragment Filtering</a></li>
<li><a href="http://www.faqs.org/rfcs/rfc3128.html">RFC3128 &#x2013; Protection Against a Tiny Fragment Attack</a></li>
</ul>
</div>
</div>
<div id="outline-container-org953bca7" class="outline-3">
<h3 id="org953bca7"><span class="section-number-3">6.2</span> Big picture</h3>
<div class="outline-text-3" id="text-6-2">

<div class="figure">
<p><img src="./chains.png" alt="chains.png">
</p>
</div>
</div>
</div>

<div id="outline-container-orga58e179" class="outline-3">
<h3 id="orga58e179"><span class="section-number-3">6.3</span> Basic Examples</h3>
<div class="outline-text-3" id="text-6-3">
<p>
You have to be <b>root</b> (<code>sudo</code>) to execute iptables functions.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Add a rule into the INPUT chain, to drop all packets from 147.8.212.123, do</span>
iptables -A INPUT -s 147.8.212.123 -p all -j DROP

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">To delete this rule, do</span>
iptables -D INPUT -s 147.8.212.123 -p all -j DROP

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Drop ICMP packets from localhost, do</span>
iptables -A INPUT -s 127.0.0.1 -p icmp -j DROP

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Drop ping packets from anywhere except localhost, do</span>
iptables -A INPUT -s ! 127.0.0.1 -p all -j DROP

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Filter a network segment, do</span>
iptables -A INPUT -s 192.168.1.0/24 -p all -j DROP
</pre>
</div>
</div>
</div>

<div id="outline-container-org483936b" class="outline-3">
<h3 id="org483936b"><span class="section-number-3">6.4</span> More Examples</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Syn-flood protection</span>
iptables -A FORWARD -p tcp --syn -m limit --limit 1/s -j ACCEPT

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Furtive port scanner proctetion</span>
iptables -A FORWARD -p tcp --tcp-flags SYN,ACK,FIN,RST RST -m limit --limit 1/s -j ACCEPT

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Ping of death proctetion</span>
iptables -A FORWARD -p icmp --icmp-type echo-request -m limit --limit 1/s -j ACCEPT
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf8e73fa" class="outline-2">
<h2 id="orgf8e73fa"><span class="section-number-2">7</span> netcat &#x2014; TCP/IP swiss army knife</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li>From <a href="http://www.g-loaded.eu/2006/11/06/netcat-a-couple-of-useful-examples/">http://www.g-loaded.eu/2006/11/06/netcat-a-couple-of-useful-examples/</a></li>
</ul>
</div>
<div id="outline-container-org9735cca" class="outline-3">
<h3 id="org9735cca"><span class="section-number-3">7.1</span> Setup a simple C/S chat session</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Suppose the server IP is <code>202.203.132.244</code>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">At the server side, do</span>
nc -l 3333

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">At the client side, do</span>
nc 202.203.132.244 3333
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">Start chatting</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org08306cd" class="outline-3">
<h3 id="org08306cd"><span class="section-number-3">7.2</span> Transferring Files</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">1. Similar to the chat example above, at the server side, do</span>
cat backup.iso | nc -l 3333

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">2. At the client side, do</span>
nc 202.203.132.242 3333 &gt; backup.iso

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">As you may have noticed, netcat does not show any info about the progress of the</span>
<span style="color: #607d8b;">#   </span><span style="color: #607d8b;">data transfer. This is inconvenient when dealing with large files. In such cases, a</span>
<span style="color: #607d8b;">#   </span><span style="color: #607d8b;">pipe-monitoring utility like =pv= can be used to show a progress indicator. For</span>
<span style="color: #607d8b;">#   </span><span style="color: #607d8b;">example, the following shows the total amount of data that has been transfered in</span>
<span style="color: #607d8b;">#   </span><span style="color: #607d8b;">real-time on the server side:</span>
cat backup.iso | pv -b | nc -l 3333

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Of course, the same can be implemented on the client side by piping netcat's output through =pv=:</span>
nc 202.203.132.242 3333 | pv -b &gt; backup.iso
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf43aeef" class="outline-3">
<h3 id="orgf43aeef"><span class="section-number-3">7.3</span> Other Examples</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">1. Netcat is extremely useful for creating a partition image and sending it to a remote machine on-the-fly:</span>
dd <span style="color: #EF6C00;">if</span>=/dev/hdb5 | gzip -9 | nc -l 3333

<span style="color: #607d8b;"># </span><span style="color: #607d8b;">On the remote machine, connect to the server and receive the partition image with the following command:</span>
nc 202.203.132.242 3333 | pv -b &gt; myhdb5partition.img.gz
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">This might not be as classy as the partition backups using =partimage=, but it is efficient.</span>

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">2. Another useful thing is to compress the critical files on the server machine with =tar=</span>
<span style="color: #607d8b;">#      </span><span style="color: #607d8b;">and have them pulled by a remote machine:</span>
tar -czf - /etc/ | nc -l 3333
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">As you can see, there is a dash in the tar options instead of a filename. This is because</span>
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">tar's output needs to be passed to netcat.</span>

<span style="color: #607d8b;"># </span><span style="color: #607d8b;">On the remote machine, the backup is pulled in the same way as before:</span>
nc 202.203.132.242 3333 | pv -b &gt; mybackup.tar.gz

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">3. IPv6</span>
<span style="color: #607d8b;"># </span><span style="color: #607d8b;">In terminal A:</span>
nc -6 -l 3333

<span style="color: #607d8b;"># </span><span style="color: #607d8b;">In terminal B:</span>
nc -6 ::1 3333
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bf4547" class="outline-3">
<h3 id="org6bf4547"><span class="section-number-3">7.4</span> Telnet-like Usage</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Netcat can be used in order to talk to servers like telnet does. For example, in order
to get the definition of the word “server” from the “WordNet” database at the dict.org
dictionary server, I’d do:
</p>
<div class="org-src-container">
<pre class="src src-sh">nc dict.org 2628
DEFINE wn server
</pre>
</div>
</div>
</div>

<div id="outline-container-org163a546" class="outline-3">
<h3 id="org163a546"><span class="section-number-3">7.5</span> Works as a Port Scanner too</h3>
<div class="outline-text-3" id="text-7-5">
<p>
A useful command line flag is <code>-z</code>. When it is used, netcat does not initiate a
connection to the server, but just informs about the open port it has found. Also,
instead of a single port, it can accept a port-range to scan. For example:
</p>
<div class="org-src-container">
<pre class="src src-sh">nc -z cs3.swfu.edu.cn 80-90
</pre>
</div>

<p>
In this example, netcat scanned the 80-90 range of ports.
</p>
</div>
</div>
<div id="outline-container-org98fa32b" class="outline-3">
<h3 id="org98fa32b"><span class="section-number-3">7.6</span> Grab Port Banners</h3>
<div class="outline-text-3" id="text-7-6">
<p>
So we're interested in knowing what's running behind port 80 and 21. We can use netcat to grab
port banners in the following way:
</p>
<div class="org-src-container">
<pre class="src src-sh">nc -v -n 202.203.132.242 80
nc -v -n 202.203.132.242 21
</pre>
</div>
<ul class="org-ul">
<li>more examples:
<ul class="org-ul">
<li><a href="http://en.wikipedia.org/wiki/Netcat">http://en.wikipedia.org/wiki/Netcat</a></li>
<li>The man page contains some more interesting examples, so take the time to read it.</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org7364b0f" class="outline-2">
<h2 id="org7364b0f"><span class="section-number-2">8</span> nmap &#x2014; Network exploration tool and security / port scanner</h2>
<div class="outline-text-2" id="text-8">
<p>
You have to be <b>root</b> to execute most nmap functions.
</p>
<ul class="org-ul">
<li><b>References</b>
<ul class="org-ul">
<li><a href="http://www.gnulinuxclub.org/index.php?option=com_content&amp;task=view&amp;id=350&amp;Itemid=31">NMap tutorial for beginners</a></li>
<li><a href="http://nmap.org/bennieston-tutorial/">NMAP - A Stealth Port Scanner</a></li>
</ul></li>
</ul>
</div>
<div id="outline-container-org83e0c1b" class="outline-3">
<h3 id="org83e0c1b"><span class="section-number-3">8.1</span> Simple Examples</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-sh">nmap 202.203.132.244

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">no reverse DNS lookup:</span>
nmap -n 202.203.132.244

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">verbose:</span>
nmap -n -v 202.203.132.244

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">even more:</span>
nmap -n -vv 202.203.132.244
</pre>
</div>
</div>
</div>

<div id="outline-container-org1513d88" class="outline-3">
<h3 id="org1513d88"><span class="section-number-3">8.2</span> Scanning more than one machine</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-sh">nmap -n -vv 202.203.132.242,244
nmap -n -vv 202.203.132.241-244
nmap -n -vv 202.203.132.241-242,244
nmap -n -vv 202.203.132.*
nmap -n -vv 202.203.132.192-255
nmap -n -vv 202.203.132.192/26

nmap -vv -n 192.168.0-2.*
nmap -vv -n 192.168.0,1,2.0-255
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0fc6e1" class="outline-3">
<h3 id="orga0fc6e1"><span class="section-number-3">8.3</span> Scanning specific ports:</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">
<pre class="src src-sh">nmap -vv -n -p 80 202.203.132.244
nmap -vv -n -p 21,23,25,80-120 202.203.132.244
nmap -vv -n -p 21,23,25,80-120 202.203.132.241-244
</pre>
</div>
</div>
</div>

<div id="outline-container-org9af6caa" class="outline-3">
<h3 id="org9af6caa"><span class="section-number-3">8.4</span> Various Scanning options:</h3>
<div class="outline-text-3" id="text-8-4">
<p>
There are many scanning options available with Nmap. All have their advantages and
disadvantages. You should use them according to your requirements.
</p>
</div>

<div id="outline-container-org6122615" class="outline-4">
<h4 id="org6122615"><span class="section-number-4">8.4.1</span> <code>-sS</code></h4>
<div class="outline-text-4" id="text-8-4-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">SYN scanning (this is the default option)</span>
nmap -vv -n -sS 202.203.132.244
</pre>
</div>

<p>
TCP SYN scan gather information about open ports without completing the TCP handshake
process. When an open port is identified, the TCP handshake is reset before it can be
completed. This technique is often referred to as “half open” scanning.
</p>

<p>
It's the default scanning technique if you are <b>root</b>. It's the most common scan to
use because it works on all networks, across all operating systems.
</p>

<dl class="org-dl">
<dt>ADV</dt><dd>The TCP SYN scan never actually creates a TCP session so isn't logged by the
destination host's applications. And hence it's a quiet scan.</dd>
<dt>DISADV</dt><dd>You need privileged access to the system.</dd>
</dl>
</div>
</div>

<div id="outline-container-orgb6ca27f" class="outline-4">
<h4 id="orgb6ca27f"><span class="section-number-4">8.4.2</span> <code>-sT</code></h4>
<div class="outline-text-4" id="text-8-4-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">TCP connect scanning</span>
nmap -vv -n -sT 202.203.132.244
</pre>
</div>
<p>
It performs the 3-way handshake.
</p>
<dl class="org-dl">
<dt>ADV</dt><dd>You don't need to have privileged access.</dd>
<dt>DISADV</dt><dd>Since it completes a TCP connection so apparent when application
connection logs are examined.</dd>
</dl>

<p>
<b>I would suggest you to never ever use this scan</b>.
</p>
</div>
</div>

<div id="outline-container-orgf4aa76f" class="outline-4">
<h4 id="orgf4aa76f"><span class="section-number-4">8.4.3</span> <code>-sF</code>, <code>-sX</code>, <code>-sN</code></h4>
<div class="outline-text-4" id="text-8-4-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">FIN scan</span>
nmap &#8211;vv &#8211;n &#8211;sF 218.194.106.91

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">Xmas tree scan</span>
nmap &#8211;vv &#8211;n &#8211;sX 192.168.0.1

<span style="color: #607d8b;">### </span><span style="color: #607d8b;">NULL scan</span>
nmap &#8211;vv &#8211;n &#8211;sN 192.168.0.1
</pre>
</div>

<p>
These are called “stealth” scans. They send a single frame to a TCP port without any TCP
handshaking or additional packet transfers. They are more “stealth” than SYN scan and must be
used if the remote machine is not a Windows-based machine. I’ll tell you why.
</p>

<p>
These scans operate by manipulating the bits of the TCP header. Nmap creates TCP headers that
combine bit options that should never occur in the real world. These purposely mangled TCP
header packets are thrown at a remote device, and nmap watches for the responses.
</p>

<p>
Window-based systems will reply with a RST frame for all queries, regardless of the status of
the specific port that was queried.
</p>

<dl class="org-dl">
<dt>ADV</dt><dd>Since no TCP sessions are established, they are quiet stealthy.</dd>
<dt>DISADV</dt><dd>Can't be used against windows-based machine.</dd>
</dl>
</div>
</div>

<div id="outline-container-org0616a40" class="outline-4">
<h4 id="org0616a40"><span class="section-number-4">8.4.4</span> <code>-sU</code></h4>
<div class="outline-text-4" id="text-8-4-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">UDP scan</span>
nmap -vv -n -sU 202.203.132.244
</pre>
</div>
<p>
The only scan in the arsenal of Nmap to identify UDP ports.
</p>
</div>
</div>
<div id="outline-container-org913be65" class="outline-4">
<h4 id="org913be65"><span class="section-number-4">8.4.5</span> <code>-sO</code></h4>
<div class="outline-text-4" id="text-8-4-5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Protocol scan</span>
nmap -vv -n -sO 202.203.132.244
</pre>
</div>
<p>
Sometimes it has to be checked that what protocols the remote machine is running. It locates
uncommon IP protocols that may be in use on the remote system. Hence it helps determining the
type of remote device, i.e. is that router or printer or workstation etc.
</p>

<dl class="org-dl">
<dt>DISADV</dt><dd>This scan will appear on any network monitoring application that identifies the IP
protocol types in use.</dd>
</dl>
</div>
</div>

<div id="outline-container-org12f5e6e" class="outline-4">
<h4 id="org12f5e6e"><span class="section-number-4">8.4.6</span> <code>-sR</code></h4>
<div class="outline-text-4" id="text-8-4-6">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">RPC scan</span>
nmap -vv -sR 202.203.132.244
</pre>
</div>
<p>
It's used to locate and identify RPC applications. It runs automatically during a version scan
(-sV, explained later)
</p>

<dl class="org-dl">
<dt>DISADV</dt><dd>RPC scan opens application sessions and hence it will be logged.</dd>
</dl>
</div>
</div>

<div id="outline-container-org8713433" class="outline-4">
<h4 id="org8713433"><span class="section-number-4">8.4.7</span> <code>-sV</code></h4>
<div class="outline-text-4" id="text-8-4-7">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Version scan</span>
nmap &#8211;vv &#8211;sV 202.203.132.244
</pre>
</div>
<p>
The scans which we have seen by now give you the status of the port and the service running on
them. For exploiting the service you need the exact version number of the service. Version scan
gives you this.
</p>

<dl class="org-dl">
<dt>DISADV</dt><dd>It opens sessions with the remote applications, which will often display in an
application's log file.</dd>
</dl>
</div>
</div>

<div id="outline-container-org3806be8" class="outline-4">
<h4 id="org3806be8"><span class="section-number-4">8.4.8</span> <code>-sA</code></h4>
<div class="outline-text-4" id="text-8-4-8">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">ACK scan</span>
nmap &#8211;vv &#8211;sA 218.194.106.91
</pre>
</div>
<p>
It's quite useful when there is some packet filtering device or firewall. It never locates an
open port. It does the job of identifying ports that are filtered through a firewall. It doesn't
open any application sessions and hence the conversation between nmap and the remote device is
relatively simple.
</p>
<dl class="org-dl">
<dt>DISADV</dt><dd>It can only tell whether port is filtered or unfiltered.  But can never definitively
identify an open port.</dd>
</dl>
</div>
</div>

<div id="outline-container-orgd2e9d28" class="outline-4">
<h4 id="orgd2e9d28"><span class="section-number-4">8.4.9</span> <code>-sI</code></h4>
<div class="outline-text-4" id="text-8-4-9">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Idle scan</span>
nmap &#8211;vv &#8211;sI 218.194.106.91
</pre>
</div>
<p>
It's the stealthy most scan you can have. Tough to launch because you need a zombie for it. It
would not be justice with this great scan to be described in just few lines. I would recommend
you to read it in detail.
</p>
<dl class="org-dl">
<dt>ADV</dt><dd>You will never be caught.</dd>
<dt>DISADV</dt><dd>Tough to launch as it's not easy to find some zombie machine.</dd>
</dl>
</div>
</div>

<div id="outline-container-orgd011319" class="outline-4">
<h4 id="orgd011319"><span class="section-number-4">8.4.10</span> <code>-sP</code>: Ping scan</h4>
<div class="outline-text-4" id="text-8-4-10">
<p>
You must have heard of <i>ping sweep</i>. It's Nmap's ping sweep.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;"># </span><span style="color: #607d8b;">To check whether this machine is up or not, do</span>
nmap &#8211;vv &#8211;sP 192.168.0.10

<span style="color: #607d8b;"># </span><span style="color: #607d8b;">To check the whole subnet (254) machines and will tell you which are up.</span>
nmap &#8211;vv &#8211;sP 192.168.0.*
</pre>
</div>
<dl class="org-dl">
<dt>DISADV</dt><dd>Ping scan will not interoperate with any other type of scan.</dd>
</dl>
</div>
</div>

<div id="outline-container-org9e97383" class="outline-4">
<h4 id="org9e97383"><span class="section-number-4">8.4.11</span> <code>-sW</code>: Window scan</h4>
<div class="outline-text-4" id="text-8-4-11">
<p>
Forget it. As the number of operating systems vulnerable to its methodology is dwindling as
operating systems are upgraded and patched.
</p>
</div>
</div>

<div id="outline-container-org5ad92d4" class="outline-4">
<h4 id="org5ad92d4"><span class="section-number-4">8.4.12</span> <code>-sL</code>: List scan</h4>
<div class="outline-text-4" id="text-8-4-12">
<p>
Would like to say only one line about it that you must use it if a separate application provides
nmap with a list of IP addresses. Rest read yourself.
</p>
</div>
</div>
</div>

<div id="outline-container-orgdb0e4d5" class="outline-3">
<h3 id="orgdb0e4d5"><span class="section-number-3">8.5</span> O/S fingerprinting and version detection</h3>
<div class="outline-text-3" id="text-8-5">
<p>
Ok, now you can use various scanning techniques to look for open/closed or filtered/unfiltered
TCP as well as UDP ports. Don't you want to know the remote operating system running?
</p>
</div>

<div id="outline-container-org4babee1" class="outline-4">
<h4 id="org4babee1"><span class="section-number-4">8.5.1</span> <code>-O</code></h4>
<div class="outline-text-4" id="text-8-5-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Operating system fingerprinting</span>
nmap -vv -O 202.203.132.241,244
</pre>
</div>

<p>
It will tell you or at least tries its best to tell you the remote operating system along with
the version it's using. It at least need one open and one close TCP port. In case it doesn't, it
won't be able to give the accurate result. In that case you should use some third party tool.
</p>

<dl class="org-dl">
<dt>DISADV</dt><dd>A trained eye will quickly identify that someone is watching the network.</dd>
</dl>
</div>
</div>

<div id="outline-container-org2e8a88f" class="outline-4">
<h4 id="org2e8a88f"><span class="section-number-4">8.5.2</span> <code>-sV</code></h4>
<div class="outline-text-4" id="text-8-5-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #607d8b;">### </span><span style="color: #607d8b;">Version detection</span>
nmap -vv -sV 202.203.132.244
</pre>
</div>
<p>
As has been explained it will help you know the version of the service running on the remote
machine.
</p>
</div>
</div>

<div id="outline-container-org0655b81" class="outline-4">
<h4 id="org0655b81"><span class="section-number-4">8.5.3</span> <code>-A</code>: Additional, Advanced, Aggressive option</h4>
<div class="outline-text-4" id="text-8-5-3">
<p>
Its comprises of both the operating system fingerprinting process (<code>-O</code>) and the version scanning
process (<code>-sV</code>). i.e following two are same:
</p>
<div class="org-src-container">
<pre class="src src-sh">nmap -vv -sV -O 202.203.132.244
nmap -vv -A 202.203.132.244
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4acb33a" class="outline-3">
<h3 id="org4acb33a"><span class="section-number-3">8.6</span> Typical scenario</h3>
<div class="outline-text-3" id="text-8-6">
<ol class="org-ol">
<li><p>
First, we’ll sweep the network with a simple Ping scan to determine which hosts are online.
</p>
<div class="org-src-container">
<pre class="src src-sh">nmap -sP 202.203.132.192/26
</pre>
</div>
<p>
Tell me how many hosts are up?
</p></li>
<li><p>
Now we’re going to take a look at 202.203.132.240-242,244. These IPs belong to School of CIS.
We’ll scan 202.203.132.240-242,244 using a SYN scan [-sS] and -A to enable OS fingerprinting
and version detection.
</p>
<div class="org-src-container">
<pre class="src src-sh">nmap -sS -A -n -vv 202.203.132.240-242,244
</pre>
</div>
<p>
Tell me what OS they are running? What services are they running?
</p></li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: WANG Xiaolin</p>
<p class="date">Created: 2019-11-25 Mon 12:36</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.6)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
